---
title: 后端任务记录-1
date: 2023-07-13 23:54:04
tags:
---

笔者最近找工作中，拿到了一个关于后端服务设计的面试题目。虽然已经没有办法及时将结果交到面试官手中了，不过还是将这次学习过程记录下来。

任务目标如下：
![Alt text](./后端任务记录-1/task.png)

笔者在之前尝试过使用API，但是还没有过实现后端API的经历。经过在线查询，笔者选择使用golang+gin完成任务目标。

## 前期准备



由于之前没有做过编写后端接口的任务，笔者对整个任务流程没有基本的理解，需要一些例子来帮助我梳理完成任务所需要的所有步骤。
1. API设计流程
2. Web框架知识
3. FFMPEG 使用
4. 如何编写单元测试

笔者采用了官方文档循序渐进的例子+ChatGPT生成基本代码框架来完成项目的初期框架整理。尽管ChatGPT本身会胡说八道，但是对于创建低级例子这样的任务，ChatGPT出现问题的概率不大。有效地使用ChatGPT能提升我们学习效率。



## 遇到的问题
1. API设计流程
    在设计API时，底层数据库的设计是重中之重，底层数据库设计决定了后续能够实现的功能多寡，以及功能如何实现。因此，在拿到业务内容初期就优先从数据库出发将业务逻辑设计好。而后再开始动手。

    在任务开始阶段，急于去实现具体的接口功能会让后续的开发陷入不利的状态。可以借用各种思维导图工具等将业务逻辑梳理清楚。再根据项目需求决定内容是否需要冗余内容设计。

    在使用思维导图进行设计的同时，要注意不要掉入过分细节坑里去。将整个任务作为一个整体进行推进，尽可能使得每个部分的细节程度相似。


2. 在任务目标中，我们需要记录时间。已知POST难以直接将STRING Bind 到 time.Time 或 time.Duration.
3. 
    针对FFMPEG本身裁剪功能，我们需要将时间表示为 HH:MM:SS格式。在进行开发时，笔者并不知道时间可以直接以字符串的形式存储，导致在各种int类型和time类型之间的转换中浪费了太多的时间。而后发现在FFMPEG中时间戳基本都是以时间字面值的形式直接传递给程序。在那之后也发现在没有对视频内容本身进行处理的情况下我们也不会对时间字面值进行任何操作。因此，使用String直接存储时间在这个场景下非常合理。

    在以后遇到类似视频时间戳相关的任务内容时，尽可能使用String对时间戳进行保存，并使用标准库对时间内容进行调整。


4. ffmpeg 使用
    在ffmpeg中，想要裁剪一段视频，我们可以使用以下指令
    ```ffmpeg -i input.mp4 -ss 00:05:10 -to 00:15:30 -c:v copy -c:a copy output2.mp4```
    其中 -i 指定输入 
    -ss 指定启动时间 
    -to 指定结束时间 
    -codex:v 指定如何处理视频轨道 
    -codex:a 指定如何处理音频轨道
    而ffmpeg的参数会依次作用在输入\输出视频上，所以参数的出现位置对结果也会有很大影响

    以上这些参数也已经囊括了大多数平日会用到的视频操作参数了，再之后如果需要研究ffmpeg的话可以单独开一个Post去记录ffmepg相关的内容


## 一些可以随便记一笔的小问题：
1. 任何地方字符串可以使用 fmt.Sprintf 进行 formatting
2. 在生成字符串这件事上可以看strconv库的用法
3. exec库可以帮助执行命令行指令并获取结果
4. gin.context 可以再多看看
5. 绑定内容时用c.BindJSON() 而不是 c.Bind()


## 数据库相关问题
使用SQL创建表
``` SQL

CREATE TABLE `test`(
	`id` int(10) unsigned NOT NULL AUTO_INCREMENT,
	`timestamp` time DEFAULT '00:00:00' COMMENT '测试时间',
	PRIMARY KEY (`id`)
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='测试'; 

```
需要注意符号的使用 "`"
需要设置PRIMARY KEY
最后的"COMMENT=" 和 上面的 "COMMENT 'xx'"不同 

TIME型变量在Golang读取时会以HH:MM:SS格式用ASCII码输出